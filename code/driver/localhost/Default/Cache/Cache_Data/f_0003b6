(function(n){ListManager=Class.extend({templates:{},selectors:{},events:{overlayCallBack:function(){}},tokens:{listName:"listName",renameList:"rename",deleteList:"delete",saveList:"save",cancelList:"cancel",enterNewListName:"enterNewName",enterSearchListCriteria:"enterSearchCriteria",groupList:"groupItem",creatingList:"creatingList",renamingList:"renamingList",deletingList:"deletingList",fetchingLists:"fetchingLists",updatingList:"updatingList",confirmDeleteItem:"confirmDeleteItem"},defaults:{serviceName:"factiva.com.ui.services.ListService"},init:function(t){t=t||{};var i=n.extend({name:"ListManager"},t);this.options=n.extend(!0,{},this.defaults,i.options);this.templates=n.extend(!0,{},this.templates,this.options.templates);this.tokens=n.extend(!0,{},this.tokens,this.options.tokens);this.events=n.extend(!0,{},this.events,this.options.events);this.listType=this.options.listType;this.serviceName=this.options.serviceName;this.autoSuggestType=this.options.autoSuggestType;this.elementIds=this.generateIds();this.selectors=this.generateSelectors();this.selectedItems=[];this.unselectedItems=[]},generateIds:function(){return{overlayId:"ml_"+this.listType+"_overlay",listName:"ml_"+this.listType+"_createlist",createGroupList:"ml_"+this.listType+"_createlistgroup",slectedList:"ml_"+this.listType+"_selected_list",searchBox:"ml_"+this.listType+"_searchlist",searchButton:"ml_"+this.listType+"_searchlistbutton",searchResults:"ml_"+this.listType+"_list",saveList:"ml_"+this.listType+"_savelist",cancelSaveList:"ml_"+this.listType+"_cancellist",renameList:"ml_"+this.listType+"_renamelist",deleteList:"ml_"+this.listType+"_deletelist",pipeSeparator:"ml_"+this.listType+"_pipe",companySearchNameOnly:"ml_co_searchnameonly",srcOptionTable:"ml_sc_option_table",srcCatTable:"ml_sc_category_table"}},generateSelectors:function(){var n={};for(var t in this.elementIds)n[t]="#"+this.elementIds[t];return n},setSelectionArray:function(n){this.selectedItems=n},clearSelectionArray:function(){this.selectedItems=[]},getCodeFromSubitem:function(n){return n.code},getNameFromSubitem:function(n){return n.name},createListOverlay:function(t){var r=FactivaGlobal.isAdmin,i=this;if(n(this.selectors.overlayId).length==0)this._initOverlay(!1);else{n(this.selectors.saveList).unbind("click");switch(this.listType){case"sc":n(this.selectors.saveList).bind("click",n.proxy(i.createSourceList,i));break;default:n(this.selectors.saveList).bind("click",n.proxy(i.createList,i))}}t&&(i.events.overlayCallBack=t);n(this.selectors.renameList).hide();n(this.selectors.deleteList).hide();n(this.selectors.pipeSeparator).hide();r?n(this.selectors.createGroupList).parent().show():n(this.selectors.createGroupList).parent().hide();this._clearSelections();n(this.selectors.overlayId).overlay({background:!0,closeOnEsc:!0})},editListOverlay:function(t,i){var r=this;if(n(r.selectors.overlayId).length==0)r._initOverlay(!0);else{n(r.selectors.saveList).unbind("click");switch(r.listType){case"sc":n(r.selectors.saveList).bind("click",n.proxy(MLManager.updateSourceList,r));break;case"co":n(r.selectors.saveList).bind("click",n.proxy(MLManager.updateCompanyList,r));break;default:n(r.selectors.saveList).bind("click",n.proxy(r.updateList,r))}}i&&(r.events.overlayCallBack=i);n(r.selectors.renameList).show();n(r.selectors.deleteList).show();n(r.selectors.pipeSeparator).show();n(r.selectors.createGroupList).parent().hide();n(r.selectors.listName).attr("listid",t);n(r.selectors.renameList+", "+r.selectors.deleteList).removeClass("overlaylinkdisable");this._clearSelections();n(this.selectors.overlayId).overlay({background:!0,closeOnEsc:!0});r.fetchListItems(t)},_initOverlay:function(t){var i=this;n(document.body).append(i.editTemplate());n(i.selectors.listName).keyup(function(){n(i.selectors.listName).val().length==0?(n(i.selectors.renameList).hasClass("overlaylinkdisable")||n(i.selectors.renameList+", "+i.selectors.deleteList).toggleClass("overlaylinkdisable"),n(i.selectors.createGroupList).attr("disabled","disabled")):(n(i.selectors.renameList).hasClass("overlaylinkdisable")&&n(i.selectors.renameList+", "+i.selectors.deleteList).toggleClass("overlaylinkdisable"),n(i.selectors.createGroupList).removeAttr("disabled"))});switch(i.listType){case"co":n(i.selectors.saveList).bind("click",n.proxy(t?MLManager.updateCompanyList:i.createList,i));break;case"sc":n(i.selectors.saveList).bind("click",n.proxy(t?MLManager.updateSourceList:i.createSourceList,i));break;default:n(i.selectors.saveList).bind("click",n.proxy(t?i.updateList:i.createList,i))}n(i.selectors.renameList).click(function(){i.renameList()});n(i.selectors.deleteList).click(function(){i.removeList()});n(i.selectors.cancelSaveList).click(function(){n().overlay.hide(i.selectors.overlayId)});n(i.selectors.searchButton).click(function(){var t;switch(i.listType){case"co":t=n("#ml_co_searchlist").val();t.length==0?(alert(translate("enterSearchCriteria")),n("#ml_co_searchlist").focus()):MLManager.searchCompanyList("c");break;case"sc":t=n("#ml_sc_searchlist").val();t.length==0?(alert(translate("enterSearchCriteria")),n("#ml_sc_searchlist").focus()):MLManager.searchSourceList();break;default:i.lookUp()}});typeof np!="undefined"&&np.web&&np.web.widgets?i.initAutoSuggest():n.ajax({dataType:"script",cache:!0,url:FactivaHeader.settings.asHandlerUrl,success:n.proxy(i.initAutoSuggest,i)});n(i.selectors.searchBox).keyup(function(t){t.keyCode=="13"&&n(i.selectors.searchButton).trigger("click")});n(i.selectors.overlayId+" .btn").hover(function(){n(this).toggleClass("over")});n(i.selectors.overlayId).draggable({handle:".overlayheader"});n(i.selectors.overlayId).delegate(".filterPillWrap","click",function(){i.listType!="sc"&&i.removeItem(this)});n(i.selectors.overlayId).delegate(".drill_down_list","click",function(){i.lookUpDrillDown(this)});n(i.selectors.overlayId).delegate(".add-itemt-to-list","click",function(){i.onLookupItemSelect(this)})},editTemplate:function(){var n="",t=this.elementIds,i=this.tokens;return n+='<div id="'+t.overlayId+'" class="overlaycontainer">',n+='  <div class="overlayclose" onclick="$().overlay.hide(\'#'+t.overlayId+"');\"><\/div>",n+='  <div class="overlayheader">'+this._safeTokens(i.overlayheader)+"<\/div>",n+='  <div class="overlaybody">',n+='    <div class="overlaybar">',n+='      <table border="0">',n+="        <tr>",n+='          <td class="overlaytitle">'+this._safeTokens(i.listName)+"<\/td>",n+='          <td><input type="text" maxlength = "25" class="overlaycreatelist" id="'+t.listName+'" /><\/td>',n+='          <td><div class="overlaylink overlaylinkdisable" id="'+t.renameList+'">'+this._safeTokens(i.renameList)+"<\/div><\/td>",n+='          <td align="center"><div id="'+t.pipeSeparator+'" class="overlaylinkdisable">|<\/div><\/td>',n+='          <td><div class="overlaylink overlaylinkdisable" id="'+t.deleteList+'">'+this._safeTokens(i.deleteList)+"<\/div><\/td>",n+='          <td ><input type="checkbox" disabled="disabled" class="overlaycreatelistgroup" id="'+t.createGroupList+'" />'+this._safeTokens(i.groupList)+"<\/td>",n+="        <\/tr>",n+="      <\/table>",n+="    <\/div>",n+='    <div class="overlaybar">',n+='      <table border="0">',n+="        <tr>",n+='          <td><span class="overlaytextbold">'+this._safeTokens(i.listSelect)+"<\/span>:&nbsp;"+this._safeTokens(i.listSelectHelper)+"<\/td>",n+="        <\/tr>",n+="      <\/table>",n+="    <\/div>",n+='    <div class="overlaylist" id="'+t.slectedList+'"><\/div>',n+='    <div class="overlaybar">',n+='      <table border="0">',n+="        <tr>",n+='          <td><span class="overlaytextbold">'+this._safeTokens(i.listSelect)+"<\/span><\/td>",n+="        <\/tr>",n+="      <\/table>",n+="    <\/div>",n+='    <div class="overlaybar">',n+='      <table border="0">',n+="        <tr>",this.listType.toLowerCase()=="co"&&(n+='           <td><select id="'+t.companySearchNameOnly+'" name="cs"><option selected="selected" value="Name">'+translate("companyName").escapeSingleQuote()+"<\/option>",n+='<option value="Ticker">'+translate("symTypeTicker").escapeSingleQuote()+'<\/option><option value="Duns">'+translate("symTypeDuns").escapeSingleQuote()+'<\/option><option value="Fcode">'+translate("symTypeFcode").escapeSingleQuote()+"<\/option><\/select><\/td>"),n+='          <td><input type="text" maxlength="25" class="overlaycreatelist" id="'+t.searchBox+'"/><\/td>',n+='          <td style="width:100%"><div class="overlaysearchbutton" id="'+t.searchButton+'"><\/div><\/td>',n+="        <\/tr>",n+="      <\/table>",this.listType.toLowerCase()=="sc"&&(n+='      <table border="0" id="'+t.srcOptionTable+'">',n+="        <tr>",n+='          <td><input type="checkbox" checked="checked" class="overlaycreatelistgroup" id="ml_sc_searchnameonly" /><\/td>',n+="          <td>"+translate("srchSrcNameOnly").escapeSingleQuote()+"<\/td>",n+='          <td><input type="checkbox" checked="checked" class="overlaycreatelistgroup" id="ml_sc_excludeDiscSrcs" /><\/td>',n+="          <td>"+translate("srchExcDiscSrcs").escapeSingleQuote()+"<\/td>",n+="        <\/tr>",n+="      <\/table>",n+='      <table border="0" id="'+t.srcCatTable+'">',n+="        <tr>",n+="          <td>",n+='            <div class="mnuHdr" id="scMnuHdrOverlay">',n+='              <span class="overlaytextbold">'+translate("selectFactivaCat").escapeSingleQuote()+"<\/span>",n+='              <select onchange="srcCat_onchangeOverlayCR(this)" id="scCatOverlay">',n+='                <option selected="selected" value="1">'+translate("selectOne").escapeSingleQuote()+"<\/option>",n+='                <option value="iType=sc&amp;rType=allSources">'+translate("sbCatAllSources").escapeSingleQuote()+"<\/option>",n+='                <option value="iType=sc&amp;rType=topSources">'+translate("sbCatTopSources").escapeSingleQuote()+"<\/option>",n+='                <option value="iType=sc&amp;code=root&amp;gType=i">'+translate("sbCatByInd").escapeSingleQuote()+"<\/option>",n+='                <option value="iType=sc&amp;code=root&amp;gType=l">'+translate("sbCatByLang").escapeSingleQuote()+"<\/option>",n+='                <option value="iType=sc&code=root&amp;gType=r">'+translate("sbCatByReg").escapeSingleQuote()+"<\/option>",n+='                <option value="iType=sc&amp;rType=alphaitems&amp;pType=u">'+translate("sbCatByTitle").escapeSingleQuote()+"<\/option>",n+='                <option value="iType=sc&amp;code=root&&amp;gType=t">'+translate("sbCatByType").escapeSingleQuote()+"<\/option>",n+="             <\/select>",n+="           <\/div>",n+="         <\/td>",n+="       <\/tr>",n+="     <\/table>"),n+="    <\/div>",n+='    <div class="overlaylist" id="'+t.searchResults+'"><\/div>',n+="  <\/div>",n+='  <div class="overlayfooter">',n+='    <ul class="buttons">',n+='      <li class="btn"><div class="prettyBtn primaryBtn" id="'+t.saveList+'"><span>'+this._safeTokens(i.saveList)+"<\/span><\/div><\/li>",n+='      <li class="btn"><div class="prettyBtn secondaryBtn" id="'+t.cancelSaveList+'"><span>'+this._safeTokens(i.cancelList)+"<\/span><\/div><\/li>",n+="    <\/ul>",n+="  <\/div>",n+"<\/div>"},fetchListItems:function(t){progressIndicator.display(translate(this.tokens.fetchList));var i;switch(this.listType){case"sc":i=new RequestContext(this.serviceName,null,null,n.proxy(MLManager.fetchSourceListItemsSuccess,this),this.handleError);break;case"co":i=new RequestContext(this.serviceName,null,null,n.proxy(this.fetchCompanyListItemsSuccess,this),this.handleError);break;default:i=new RequestContext(this.serviceName,null,null,n.proxy(this._fetchListCallBack,this),this.handleError)}i.Add("lType",this.listType);i.Add("rType","GetOneList");i.Add("listid",t);i.Send()},_fetchListCallBack:function(t){var u,f,i,r,e;if(progressIndicator.hide(500),u=parseJSON(t.Text),u==null)return!1;if(f=u.listItemDTO||{},n(this.selectors.overlayId+" "+this.selectors.listName).val(f.name),i=f.subItem,i)for(r=0;r<i.length;r++)e={id:this.getCodeFromSubitem(i[r]),name:this.getNameFromSubitem(i[r])},this.selectedItems.push(e);this.renderPills()},fetchCompanyListItemsSuccess:function(t){var u,f,i,r,e;if(progressIndicator.hide(500),u=parseJSON(t.Text),u==null)return!1;if(f=u.savedCompanyListItemDTO,n(this.selectors.overlayId+" "+this.selectors.listName).val(f.name),i=f.companyList.company,i)for(r=0;r<i.length;r++)e={id:this.getCodeFromSubitem(i[r]),name:this.getNameFromSubitem(i[r])},this.selectedItems.push(e);this.renderPills()},createList:function(){if(!this._validateListName())return!1;DJMetrics.captureListTypeAction(this.getListTypeMetricsActionCode("save",this.listType));progressIndicator.display(translate(this.tokens.creatingList));var i=n(this.selectors.overlayId+" "+this.selectors.listName),r=i.val(),u=this._getSelectedCodes(),t=new RequestContext(this.serviceName,i,null,n.proxy(this._createListCallBack,this),this.handleError);t.Add("lType",this.listType);t.Add("rType","AddNewList");t.Add("listName",r);t.Add("accountItem",n(this.selectors.createGroupList).is(":checked"));t.Add("arraycodes",u);t.Send()},_createListCallBack:function(t){var i=this,r;return(progressIndicator.hide(500),r=parseJSON(t.Text),r==null)?!1:(r.newItemId&&t.ClientContext.attr("listid",r.newItemId),i.events.overlayCallBack.call(i.events.overlayCallBack,i.listType),setTimeout(function(){n().overlay.hide(i.selectors.overlayId)},800),!1)},createCompanyList:function(){return DJMetrics.captureListTypeAction(this.getListTypeMetricsActionCode("save","co")),this.createCompanyListService(),!1},createCompanyListService:function(){var f=n("#ml_co_createlist").val(),e,r,u,i,o,t;if(hasIllegalChar2(f))alert(translate("illegalChar-1")+" (<, >, &, #, \\, %, +, |, ~) "+translate("illegalChar-2"));else{for(e=n("#ml_co_createlistgroup").is(":checked"),progressIndicator.display(translate("creatingList"),!1,!1,!0),r="",u=jQuery.grep(MLManager.selectedCompanies,function(n){return n.removed!==!0}),i=0;i<u.length;i++)o=u[i],r+=o.id+"_";t=new RequestContext("factiva.com.ui.services.CompaniesService",null,null,this.createCompanyListSuccess,MLManager.handleError);t.Add("rType","AddNewList");t.Add("listName",f);t.Add("accountItem",e);t.Add("arraycodes",r);t.Send()}return!1},createCompanyListSuccess:function(t){return MLManager.fetchCompanyListsSuccess(t),n("#ml_co_createlist").val(""),n("#ml_co_createlistgroup").attr("checked",!1),n().overlay.hide("#ml_co_overlay"),progressIndicator.hide(500),!1},createSourceList:function(){return DJMetrics.captureListTypeAction(this.getListTypeMetricsActionCode("save","sc")),this.createSourceListService(),!1},createSourceListService:function(){var i=n("#ml_sc_createlist").val(),r,t;return hasIllegalChar2(i)?alert(translate("illegalChar-1").escapeSingleQuote()+" (<, >, &, #, \\, %, +, |, ~) "+translate("illegalChar-2").escapeSingleQuote()):(progressIndicator.display(translate("creatingList"),!1,!1,!0),r=n("#ml_sc_createlistgroup").is(":checked"),t=new RequestContext("factiva.com.ui.services.SourcesService",null,null,this.createSourceListSuccess,MLManager.handleError),t.Add("rType","AddNewList"),t.Add("listName",i),t.Add("accountItem",r),t.Send()),!1},createSourceListSuccess:function(n){SourceListManager.fetchSourceListsSuccess(n);var t=parseJSON(n.Text),i=t.newItemId;return SourceListManager.createSourceListAddItemsService(i),progressIndicator.hide(),!1},fetchSourceListsSuccess:function(n){var t=parseJSON(n.Text);if(t==null)return!1;MLManager.processSuccessFetchList(t.listViewDTO,MLManager.getPageIdsAndSelectorForType("sc"),MLManager.editSourceListOverlay,MLManager.removeSourceList)},createSourceListAddItemsService:function(n){var r,e,t,i;progressIndicator.display(translate("creatingList"),!1,!1,!0);var u="",f=null,o=jQuery.grep(MLManager.selectedSources,function(n){return n.bool.toLowerCase()=="or"&&!n.removed==!0});for(t=0;t<o.length;t++)f=o[t],u+=f.value,u+=t<o.length-1?",":"";for(r="",e=jQuery.grep(MLManager.selectedSources,function(n){return n.bool.toLowerCase()=="not"&&!n.removed==!0}),t=0;t<e.length;t++)f=e[t],r+=f.value,r+=t<e.length-1?",":"";return i=new RequestContext("factiva.com.ui.services.SourcesService",null,null,MLManager.createSourceListAddItemsSuccess,MLManager.handleError),i.Add("rType","AddToList"),i.Add("listid",n),u.length>0&&i.Add("scs","["+u+"]"),r.length>0&&i.Add("xsc","["+r+"]"),i.Send(),!1},createSourceListAddItemsSuccess:function(){return n("#ml_sc_createlist").val(""),n("#ml_sc_createlistgroup").attr("checked",!1),n().overlay.hide("#ml_sc_overlay"),progressIndicator.hide(500),!1},getListTypeMetricsActionCode:function(n,t){var i="",r="create",u="edit",f="delete",e="rename",o="save";n=n.toLowerCase();switch(t){case"ns":i=n==r?"create_subject_overlay_view":n==u?"edit_subject_list":n==f?"delete_subject_list":n==o?"create_subject_list":n==e?"rename_subject_list":null;break;case"in":i=n==r?"create_industry_overlay_view":n==u?"edit_industry_list":n==f?"delete_industry_list":n==o?"create_industry_list":n==e?"rename_industry_list":null;break;case"re":i=n==r?"create_region_overlay_view":n==u?"edit_region_list":n==f?"delete_region_list":n==o?"create_region_list":n==e?"rename_region_list":null;break;case"au":i=n==r?"create_author_overlay_view":n==u?"edit_author_list":n==f?"delete_author_list":n==o?"create_author_list":n==e?"rename_author_list":null;break;case"co":i=n==r?"create_company_overlay_view":n==u?"edit_company_list":n==f?"delete_company_list":n==o?"create_company_list":n==e?"rename_company_list":null;break;case"rss":i=n==r?"create_rss_overlay_view":n==u?"edit_rss_list":n==f?"delete_rss_list":n==o?"create_rss_list":n==e?"rename_rss_list":null;break;case"sc":i=n==r?"create_source_overlay_view":n==u?"edit_source_list":n==f?"delete_source_list":n==o?"create_source_list":n==e?"rename_source_list":null;break;default:i=null}return i},updateList:function(){if(!this._validateListName())return!1;DJMetrics.captureListTypeAction(this.getListTypeMetricsActionCode("save",this.listType));progressIndicator.display(translate(this.tokens.updatingList));var i=n(this.selectors.overlayId+" "+this.selectors.listName),r=i.val(),u=i.attr("listid"),f=this._getSelectedCodes(),t=new RequestContext(this.serviceName,i,null,n.proxy(this._updateListCallBack,this),this.handleError);t.Add("lType",this.listType);t.Add("rType","UpdateList");t.Add("listName",r);t.Add("listid",u);t.Add("arraycodes",f);t.Send()},_updateListCallBack:function(){var t=this;return progressIndicator.hide(500),t.events.overlayCallBack.call(t.events.overlayCallBack,t.listType),setTimeout(function(){n().overlay.hide(t.selectors.overlayId)},800),!1},renameList:function(){if(!this._validateListName())return!1;DJMetrics.captureListTypeAction(this.getListTypeMetricsActionCode("rename",this.listType));progressIndicator.display(translate(this.tokens.renamingList));var i=n(this.selectors.overlayId+" "+this.selectors.listName),r=i.val(),u=i.attr("listid"),t=new RequestContext(this.serviceName,null,null,n.proxy(this._renameListCallBack,this),this.handleError);t.Add("lType",this.listType);t.Add("rType","RenameList");t.Add("listName",r);t.Add("listid",u);t.Send()},_renameListCallBack:function(){return progressIndicator.hide(500),this.events.overlayCallBack.call(this.events.overlayCallBack,this.listType),!1},removeList:function(){return n().confirmDialog({msg:translate(this.tokens.confirmDeleteItem),yesClickHandler:n.proxy(this.removeListService,this),yesClickParams:arguments}),!1},removeListService:function(){DJMetrics.captureListTypeAction(this.getListTypeMetricsActionCode("delete",this.listType));progressIndicator.display(translate(this.tokens.deletingList));var i=n(this.selectors.overlayId+" "+this.selectors.listName),r=i.attr("listid"),t=new RequestContext(this.serviceName,null,null,n.proxy(this._removeListCallBack,this),this.handleError);t.Add("lType",this.listType);t.Add("rType","DeleteList");t.Add("listid",r);t.Send()},_removeListCallBack:function(){var t=this;return progressIndicator.hide(500),this.events.overlayCallBack.call(t.events.overlayCallBack,t.listType),setTimeout(function(){n().overlay.hide(t.selectors.overlayId)},800),!1},lookUp:function(){var i=n(this.selectors.searchBox).val(),t;return i.length==0?(alert(translate(this.tokens.enterSearchListCriteria)),n(this.selectors.searchBox).focus(),!1):(progressIndicator.display(translate("searchingList"),!1,!1,!0),t=new RequestContext(this.serviceName,n(this.selectors.searchResults),null,n.proxy(this._lookUpSuccess,this),this.handleError),t.Add("rtype","LookUp"),t.Add("ltype",this.listType),t.Add("query",i),t.Send(),!1)},lookUpDrillDown:function(t){var e=n(t).attr("code"),f=n(t).find("span"),r=n(t).parents("li").eq(0),u=r.find("ul"),i;return n(t).hasClass("mnuBtn")?(f.html("-"),n(t).removeClass("mnuBtn"),n(t).addClass("mnuBtnOpen"),u.length===0?(n('<div class="mnuMsg">'+translate("loading")+"...<\/div>").appendTo(r),i=new RequestContext(this.serviceName,r,null,n.proxy(this._lookUpSuccess,this),this.handleError),i.Add("rtype","LookUp"),i.Add("ltype",this.listType),i.Add("fcode",e),i.Send()):u.show()):(f.html("+"),n(t).removeClass("mnuBtnOpen"),n(t).addClass("mnuBtn"),r.find("div.mnuMsg").remove(),u.hide()),!1},_lookUpSuccess:function(t){var u=parseJSON(t.Text),r,i;return u==null?(progressIndicator.hide(500),!1):(r=u.Text.Html,i=t.ClientContext,r&&i.length>0&&(i[0].tagName.toLowerCase()=="li"?(i.find("div.mnuMsg").remove(),n(r).appendTo(i)):i.html(r),this._setLooupSelections()),progressIndicator.hide(500),!1)},onLookupItemSelect:function(t){var i=n(t),r=i.attr("code"),u=jQuery.grep(this.selectedItems,function(n){return n.id.toLowerCase()==r.toLowerCase()});u.length>0?(i.removeClass("mnuItmInc"),this.selectedItems=jQuery.grep(this.selectedItems,function(n){return n.id.toLowerCase()!=r.toLowerCase()})):(i.addClass("mnuItmInc"),u={id:r,name:i.text()},this.selectedItems.push(u));this.renderPills()},handleError:function(n){var t=n.Error.Description;progressIndicator.hide();alert(t)},removeItem:function(n){var t=n.id,i=jQuery.grep(this.selectedItems,function(n){return n.id.toLowerCase()==t.toLowerCase()})[0];this.unselectedItems.length!=0&&this.unselectedItems.some(function(n){return n.id===t})||this.unselectedItems.push(i);this.selectedItems=jQuery.grep(this.selectedItems,function(n){return n.id.toLowerCase()!=t.toLowerCase()});this._setLooupSelections();this.renderPills()},renderPills:function(){var u=0,t="",i,r;if(t+='<div class="searchBuilderFilters">',t+='    <ul class="DJIIFilterList">',this.selectedItems.length>0)for(i=0;i<this.selectedItems.length;i++)r=this.selectedItems[i],t+='        <li class="connectionAndPillWrap">',t+='            <div class="filterPillWrap" sequence="'+u+'" mode="or" id="'+r.id+'">',t+='                <div class="pillNoMenu" style="cursor: pointer">',t+='                    <span class="filterText">'+r.name+"<\/span>",t+="                <\/div>",t+="            <\/div>",t+="        <\/li>",u++;t+="    <\/ul>";t+="<\/div>";n(this.selectors.overlayId).length&&n(this.selectors.overlayId+" "+this.selectors.slectedList).html(t)},onItemSelect:function(t){var i=t.code.toLowerCase(),r=jQuery.grep(this.selectedItems,function(n){return n.id.toLowerCase()==i});r.length>0?this.selectedItems=jQuery.grep(this.selectedItems,function(n){return n.id.toLowerCase()!=i}):(r={id:i,name:t.descriptor||t.completeName||t.value||t.formalName,sourceType:t.type},this.selectedItems.push(r));this.renderPills();n(this.selectors.searchBox).val("")},onInfoClicked:function(){},initAutoSuggest:function(){var i=this,r=window.parent&&window.parent.FactivaHeader?window.parent.FactivaHeader:FactivaHeader,t={url:r.settings.asServiceUrl,controlId:i.elementIds.searchBox,controlClassName:"djAutoComplete",autocompletionType:i.autoSuggestType,maxResults:"10",resultsClass:"dj_emg_autosuggest_results popup_autosuggest_results "+(this.options.hideIconDetails?"hide-icon-details":""),resultsOddClass:"dj_emg_autosuggest_even",resultsEvenClass:"dj_emg_autosuggest_even",resultsOverClass:"dj_emg_autosuggest_over",selectFirst:!1,tokens:r.tokens.autoSuggest,options:{maxResults:10},useSessionId:r.settings.sessionId,onItemSelect:function(n){if(i.listType=="sc")source_autosuggestItm_click(n);else i.onItemSelect(n)},onInfoClick:function(n){i.onInfoClicked(n)}};switch(i.autoSuggestType){case"Source":t.options=n.extend(!0,t.options,{status:"active",interfaceLanguage:r.settings.interfaceLanguage,includeSourceFamily:"true",types:"1|2|3|4|5"});break;case"Company":t.url=r.settings.asCompanyServiceUrl;t.options=n.extend(!0,t.options,{dataSet:"newsCodedAbt",filterADR:"false"});break;default:t.options=n.extend(!0,t.options,{status:"active",interfaceLanguage:r.settings.interfaceLanguage})}t.tokens={infoTitleTkn:translate("infoTitleTknPre")+"|true|"+translate("infoTitleTknPost"),infoTitleTknPre:translate("infoTitleTknPre"),infoTitleTknPost:translate("infoTitleTknPost"),sourcefamilyTkn:translate("sourcefamilyTkn"),publicationTkn:translate("publication"),webpageTkn:translate("webSite"),multimediaTkn:translate("multimedia"),pictureTkn:translate("picture"),blogTkn:translate("blog"),disContTkn:translate("discontSrcTitle"),promoteTitleTkn:translate("promoteTitleTkn")};np.web.widgets.autocomplete(t)},_safeTokens:function(n){var t=translate(n);return t==null?null:t.replace(/'/g,"'")},_setLooupSelections:function(){var t=this,i=n(t.selectors.searchResults).find(".mnuItm");if(i.length==0)return!1;i.removeClass("mnuItmInc");t.selectedItems.length>0&&n.each(i,function(i,r){for(var f=n(r).attr("code").toLowerCase(),u=0;u<t.selectedItems.length;u++)f==t.selectedItems[u].id.toLowerCase()&&n(r).addClass("mnuItmInc")})},_getSelectedCodes:function(){var t=[];return(n.each(this.selectedItems,function(n,i){t.push(i.id)}),t.length>0)?t.join("_"):""},_validateListName:function(){var t=n(this.selectors.listName).val();return n.trim(t).length==0?(n(this.selectors.listName).focus(),alert(translate(this.tokens.enterNewListName)),!1):hasIllegalChar2(t)?(n(this.selectors.listName).focus(),alert(translate("illegalChar-1")+" (<, >, &, #, \\, %, +, |, ~) "+translate("illegalChar-2")),!1):!0},_clearSelections:function(){n(this.selectors.listName).val("");n(this.selectors.searchBox).val("");n(this.selectors.slectedList).html("");n(this.selectors.searchResults).html("");n(this.selectors.overlayId).overlay({background:!0,closeOnEsc:!0});this.clearSelectionArray();this.listType=="sc"&&(MLManager.selectedSources=[])},_getMaxZIndex:function(){return Math.max.apply(null,n.map(n("body > *"),function(t){return n(t).css("position")=="absolute"?parseInt(n(t).css("z-index"))||1:1e3}))}})})(jQuery),function(n){var t=ListManager.extend({init:function(t){t=t||{};var i=n.extend({name:"CompanyListManager",options:{dataSet:"newsCodedAbt",filterADR:"false",autoSuggestType:"Company",listType:"co",serviceName:"factiva.com.ui.services.CompaniesService",tokens:{fetchList:"fetchingCompanyLists",overlayheader:"companyListEditor",listSelect:"listSearchCompanies",listSelectHelper:"listSelectCompaniesHelper"}}},t);this._super(i)},onInfoClicked:function(n){var t=n.code,i=n.descriptor;RIND.getEntityDetails(i,t,"co",!1)}});CompanyListManager=new t}(jQuery),function(n){var t=ListManager.extend({init:function(t){t=t||{};var i=n.extend({name:"ExecutiveListManager",options:{hideIconDetails:!0,autoSuggestType:"Executive",listType:"pe",serviceName:"factiva.com.ui.services.ListService",tokens:{fetchList:"fetchingExecutivesList",overlayheader:"executiveListEditor",listSelect:"selectExecutives",listSelectHelper:"listSelectExecutivesHelper"}}},t);this._super(i)},getNameFromSubitem:function(n){return n.name.fullName},getCodeFromSubitem:function(n){return n.consolidatedId}});ExecutiveListManager=new t}(jQuery),function(n){var t=ListManager.extend({init:function(t){t=t||{};var i=n.extend({name:"IndustryListManager",options:{autoSuggestType:"Industry",listType:"in",serviceName:"factiva.com.ui.services.ListService",tokens:{fetchList:"fetchingIndustryList",overlayheader:"industryListEditor",listSelect:"selectIndustries",listSelectHelper:"listSelectIndustriesHelper"}}},t);this._super(i)},onInfoClicked:function(n){var t=n.code,i=n.descriptor;RIND.getEntityDetails(i,t,"in",!1)}});IndustryListManager=new t}(jQuery),function(n){var t=ListManager.extend({init:function(t){t=t||{};var i=n.extend({name:"RegionListManager",options:{listType:"re",autoSuggestType:"Region",serviceName:"factiva.com.ui.services.ListService",tokens:{fetchList:"fetchingRegionList",overlayheader:"regionListEditor",listSelect:"selectRegions",listSelectHelper:"listSelectRegionsHelper"}}},t);this._super(i)},onInfoClicked:function(n){var t=n.code,i=n.descriptor;RIND.getEntityDetails(i,t,"re",!1)}});RegionListManager=new t}(jQuery),function(n){var t=ListManager.extend({init:function(t){t=t||{};var i=n.extend({name:"SourceListManager",options:{includeSourceFamily:"true",types:"1|2|3|4|5",autoSuggestType:"Source",listType:"sc",serviceName:"factiva.com.ui.services.SourcesService",tokens:{fetchList:"fetchingSourceLists",overlayheader:"srcListEditor",listSelect:"listSelectSources",listSelectHelper:"listSelectSourcesHelper"}}},t);this._super(i)},onInfoClicked:function(n){var t=n.code,i=n.descriptor,r=n.type=="sourcefamily";RIND.getEntityDetails(i,t,"sc",r)}});SourceListManager=new t}(jQuery),function(n){var t=ListManager.extend({init:function(t){t=t||{};var i=n.extend({name:"SubjectListManager",options:{listType:"ns",autoSuggestType:"NewsSubject",serviceName:"factiva.com.ui.services.ListService",tokens:{fetchList:"fetchingSubjectList",overlayheader:"subjectListEditor",listSelect:"selectSubjects",listSelectHelper:"listSelectSubjectsHelper"}}},t);this._super(i)},onInfoClicked:function(n){var t=n.code,i=n.descriptor;RIND.getEntityDetails(i,t,"ns",!1)}});SubjectListManager=new t}(jQuery);
