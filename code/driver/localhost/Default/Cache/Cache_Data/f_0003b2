function encodeApostrophes(n){var i={};for(var t in n)n.hasOwnProperty(t)&&n[t]&&n[t].constructor===String&&(n[t]=n[t].replace("'","&#39;").replace('"',"&#34;"),i[t+"Lnk"]=n[t].replace("&#34;","\\&#34;"));n=$.extend(n,i)}function showAuthorInfo(n,t,i){var f;logInfoClickOmniture(n,t,i);DJMetrics.captureViewDetailsClick("au",n,i);var r={title:translate("admTitle"),alsoFor:translate("admAlsoWritesFor"),note:translate("admNote"),noteMessage:translate("admNoteMessage"),vcard:translate("admVCard"),authorCode:translate("admAuthorCode"),seeArticles:translate("admSeeArticles"),noProfile:translate("admNoProfile"),createNewAuthorList:translate("createNewAuthorList"),addToList:translate("addToList"),chooseList:translate("chooseList"),createNewList:translate("createNewList"),save:translate("save"),cancel:translate("cancel"),authorlist:translate("authorList"),addbtn:translate("addBtn")},e=$("#ml_au_createoverlay"),o=$("#ml_au_editoverlay"),s=e.length>0&&e.is(":visible")||o.length>0&&o.is(":visible")?!0:!1,u=_.where(authorCache,{id:n});u&&u[0]?(modalDialog({content:u[0].html,title:r.title,width:450,height:"auto"}),authorToListModal.init(n)):(modalDialog({content:translate("loading")+"...",title:r.title,width:450,height:"auto"}),f=new RequestContext("factiva.com.ui.virtserv.FactivaGateway.Authors.AuthorService",null,null,function(t){var u=t.Text,e,i,f;return u?(e=navigator.appVersion.indexOf("MSIE")!=-1,i=null,i=e?eval("("+u+")"):JSON.parse(u),encodeApostrophes(i),typeof tpl=="string"&&(tpl=_.template(tpl)),f=tpl({data:i,tokens:r,hideCreateAddToList:s}),authorCache.push({id:n,html:f}),$("#dj_modal_content").html(f)):(authorCache.push({id:n,html:r.noProfile}),$("#dj_modal_content").html(r.noProfile)),authorToListModal.init(n),!1},function(n){var t=n.Error.Description;return nu=n.Error&&n.Error.Number?n.Error.Number:"",nu=nu!=""&&nu!=null?nu=" ("+nu+")":"",$("#dj_modal_content").html(t+nu),!1}),f.Add("nnid",n),f.Send())}function seeAllArticles(n,t){var i=$("#see_also_frm"),r;i.length>0?$("#ftx",i).val("au="+n):(i=$("<form>",{action:"../ha/default.aspx?mod=AuthorInfo_SB",target:"",method:"post",id:"see_also_frm"}),$("<input>",{id:"ht",name:"ht",value:"1",type:"hidden"}).appendTo(i),$("<input>",{id:"ist",name:"ist",value:"Simple",type:"hidden"}).appendTo(i),$("<input>",{id:"cdd",name:"cdd",value:'{"chartType":"au","N":"'+t+'","I":"'+n+'"}',type:"hidden"}).appendTo(i),r=CsrfKey(),r&&$("<input>",{name:"xsrftoken",value:r,type:"hidden"}).appendTo(i),i.appendTo($("body")));i.submit()}function showExecutiveInfo(n,t){var i={title:translate("exeInfoTitle"),code:translate("execCodeLabel"),company:translate("exeInfoCompanyLabel"),noProfile:translate("execInfoNoProfile")},u=_.where(executiveCache,{id:n}),r;u&&u[0]?modalDialog({content:u[0].html,title:i.title,width:450,height:"auto"}):(modalDialog({content:translate("loading")+"...",title:i.title,width:450,height:"auto"}),r=new RequestContext("factiva.com.ui.virtserv.FactivaGateway.Executive.ExecutiveService",null,null,function(t){var u=t.Text,e,r,f;return u?(e=navigator.appVersion.indexOf("MSIE")!=-1,r=null,r=e?eval("("+u+")"):JSON.parse(u),encodeApostrophes(r),typeof tplExecutive=="string"&&(tplExecutive=_.template(tplExecutive)),f=tplExecutive({data:r,tokens:i}),executiveCache.push({id:n,html:f}),$("#dj_modal_content").html(f)):$("#dj_modal_content").html(i.noProfile),!1},function(n){var t=n.Error.Description;return nu=n.Error&&n.Error.Number?n.Error.Number:"",nu=nu!=""&&nu!=null?nu=" ("+nu+")":"",$("#dj_modal_content").html(t+nu),!1}),r.Add("exeCode",n),r.Add("coCode",t),r.Send())}function getSelectedDays(n,t){var i=[],r=!1;return $("input[name='"+n+"']:checked").val()==="Weekly"&&(r=!0),$("input[name='"+t+"']"+(r?":checked":"")).each(function(){i.push($(this).val().toLowerCase())}),i}function captureAlertSaving(n,t,i){t?captureGroupAlert(n,i):capturePersonalAlert(n)}function captureFilters(n){var r=buildFilterValues("scLst",n),u=buildFilterValues("auLst",n),f=buildFilterValues("coLst",n),e=buildFilterValues("nsLst",n),o=buildFilterValues("inLst",n),s=buildFilterValues("reLst",n),h=buildLanguageList(n),c=buildFESValue(n),t={content_sources:r,author:u,organization:f,subject:e,industry:o,region:s,factiva_expert_search:c,search_languages:h};for(var i in t)(t[i]===null||t[i]===undefined)&&delete t[i];return t}function buildFESValue(n){var t=$("#fesLst .filterPillWrap span",n),i,r;return t.length?(i=t.attr("companyid").split("_").pop(),r=t.text(),{code:i,descriptor:r}):null}function buildLanguageList(n){var i=$("#laLst .filterPillWrap span",n),t;return i.length?(t=[],i.each(function(){t.push($(this).attr("companyid").split("_").pop())}),t):null}function buildFilterValues(n,t){var r=$("#"+n+" .filterPillWrap",t),i;return r.length?(i={},r.each(function(){$(this).attr("mode")!=="not"?i.included?i.included+=1:i.included=1:i.excluded?i.excluded+=1:i.excluded=1}),i):null}function capturePersonalAlert(n){var v=$("input[name='inpids']:checked").length,e=[],s,f,l,a;$("input[name='tdct']:checked").each(function(){e.push($(this).val().toLowerCase())});var y=$("select[name='incel']").val(),p=$("select[name='iptz'] :selected").text(),o=$("select[name='infpt'] :selected").val(),w=$("input[name='incet_chk']:checked").length!==0,r=$("input[name='incet_rad']:checked").val(),t,i,u;r==="Batch"?(t=$("select[name='insef'] :selected").val(),i=$("select[name='insdf'] :selected").val(),u=$("input[name='hglg_isekh']:checked").val()==="1"):(t=$("select[name='incef'] :selected").val(),i=$("select[name='incdf'] :selected").val(),u=$("input[name='hglg_icekh']:checked").val()==="1");s=getSelectedDays("indelf","indldw");f=[];$("input[name='insdtl']:checked").each(function(){f.push($(this).val().toLowerCase())});var h=$("input[name='infb']:checked").val(),b=parseInt($("select[name='innor'] :selected").text()),k={emailFormat:t?t.toLowerCase():null,resultsDisplayFormat:i?i.toLowerCase():null,highLightSearchItemsInEmail:u,days:s,times:f,resultsSortedBy:h?h.toLowerCase():null,maximumNumbersOfResult:b},c=[];$("input[name='inbdt_chk']").each(function(){c.push($(this).is(":checked"))});l=captureFilters();a={newsPagesCount:v,emailLanguage:y,timeZone:p,removeDuplicates:o?o.toLowerCase():null,includedContent:e,individualEmail:{enabled:w,deliveryType:r?r.toLowerCase():null,options:k},bundledDeliveries:c,alertFilters:l};DJMetrics.capturePersonalAlertSaving(a,n)}function captureGroupAlert(n,t){var i=null;t&&(i=$("#groupFoldersEditorIFrame").contents());var f=$("input[name='irp']:checked",i).val(),s=captureFilters(i),e=[];$("input[name='tdct']:checked",i).each(function(){e.push($(this).val().toLowerCase())});var h=$("input[name='emailNotifyOnOff']",i).val()==="1",o=$("input[name='infpt']:checked",i).val(),r={reviseOption:f?f.toLowerCase():null,alertFilters:s,userNotification:h,includedContent:e,removeDuplicates:o?o.toLowerCase():null},u=[];$("input[name='optin_bool']:checked",i).length&&(u.push("subscribable"),r.categoriesCount=$("#userOptinContainer .connectionAndPillWrap",i).length);$("input[name='pushtousr_bool']:checked",i).length&&(u.push("assign"),r.groupsCount=$("#pushToUserContainer .connectionAndPillWrap",i).length);$("input[name='private_bool']:checked",i).length&&u.push("private");r.distributionType=u;DJMetrics.captureGroupAlertSaving(r,n)}var authorCache=[],tpl=["<div class='contact-head'>","  <div class='head-main'>","   <h4><%= data.name %><\/h4>","\t<%if (data.show_vcard && data.has_authorlists_access) {%>","\t<a id='vcardLink' href='../ha/VCardDownloader.ashx?nnid=<%= data.id %>'><%= tokens.vcard %><\/a>","\t<%}%>","  <\/div>","\t<%if (data.has_authorlists_access) {%>","   <div id='authorstListLabel'>","       <%= tokens.authorlist %> ","   <%if (!hideCreateAddToList) {%>"," |","\t<%}%>","   <\/div>","\t<%if (!hideCreateAddToList) {%>","   <div id='authorsListView' class='add'>","     <span id='authorListToggleTitle' title=''><%= tokens.addbtn %><\/span> ","     <span id='authorListToggleArrow' class='slClose' title=''><\/span>","   <\/div>","\t<%}%>","\t<%}%>","  <div class='head-sub'>","      <form action='' method='post'>","        <div class='add-wrapper'>","              <input checked='checked' id='add-to-list' name='list-select' type='radio' value='' />","              <label for='add-to-list'><%= tokens.addToList %><\/label>","              <div class='report-options-wrapper report-in-wrapper'>","                <span class='selected unselected ellipsis' title='default' listid='0'><%= tokens.chooseList %><\/span>","                <span class='fi-two fi_d-arrow-thick-drk-gray'><\/span>","                <div class='filter-wrapper'>","                  <ul class='filter-list'>","                  <\/ul>","                <\/div>","              <\/div>","            <\/div>","            <div class='create-wrapper'>","              <input id='create-new-list' name='list-select' type='radio' value='create' />","              <label for='create-new-list'><%= tokens.createNewList %><\/label>","              <input class='list-title' maxlength='30' name='list-title' type='text' value='' />","            <\/div>","            <div class='submit-wrapper'>","              <div class='dj-list-item'>","                <a class='dj_btn dj_btn-blue' href='javascript:void(0);' id='save-new-author-list'><%= tokens.save %><\/a>","                <a class='dj_btn dj_btn-grey' href='javascript:void(0);' id='cancel-new-author-list'><%= tokens.cancel %><\/a>","              <\/div>","          <\/div>","    <\/form>","  <\/div>","<\/div>","<div class='contact-body'>","\t<ul>","\t\t<li class='pub'><%= data.outlet %><\/li>","\t\t<%if (data.phone) {%>","\t\t<li class='phone'><%= data.phone %><\/li>","\t\t<%}%>","\t\t<%if (data.email) {%>","\t\t<li class='email'><a href=\"mailto:<%= data.email %>\"><%= data.email %><\/a><\/li>","\t\t<%}%>","\t\t<%if (data.twitter) {%>","\t\t<li class='twitter'><a href=\"<%= data.twitter %>\" target='_blank'><%= data.twitter %><\/a><\/li>","\t\t<%}%>","\t\t<%if (data.linkedin) {%>","\t\t<li class='linkedin'><a href=\"<%= data.linkedin %>\" target='_blank'><%= data.linkedin %><\/a><\/li>","\t\t<%}%>","\t<\/ul>","\t<%if (data.alsoWorksFor) {%>","\t<p class='also'>","\t\t<%= tokens.alsoFor %>:","\t\t<span><%= data.alsoWorksFor %><\/span>","\t<\/p>","\t<%}%>","\t<p class='code'><%= tokens.authorCode %>: <span><%= data.id%><\/span><\/p>","<\/div>","<div class='contact-footer'>","\t<p><a href='#' onclick='javascript:seeAllArticles(<%= data.id %>, \"<%= data.nameLnk %>\", \"<%= data.outletLnk %>\"); return false;'><%= tokens.seeArticles %><\/a><\/p>","<\/div>","<div class='clearfix'><\/div>"].join("\n"),authorToListModal={nnid:null,isAuthorListsLoaded:!1,$authorModalEl:null,$authorDeetsEl:null,strListTitle:null,init:function(n){var t=this;t.isAuthorListsLoaded=!1;t.nnid=n;t.$authorModalEl=$(".authors-detail-wrapper");t.$authorDeetsEl=t.$authorModalEl.find(".add");var i=$(".report-in-wrapper"),r=t.$authorModalEl.find(".open-list"),u=$(".filter-wrapper"),f=t.$authorModalEl.find("input:radio"),e=$("#save-new-author-list"),o=$("#cancel-new-author-list");t.handleEvents(t,i,r,u,f,e,o)},handleEvents:function(n,t,i,r,u,f,e){$("#create-new-list").parent().find(".list-title").focus(function(){$("#create-new-list").attr("checked",!0);$("#create-new-list").prop("checked",!0)});n.$authorDeetsEl.click(function(t){t.stopPropagation();$(this).hasClass("expanded")?(n.$authorModalEl.find(".head-sub").stop().slideUp(100),$(this).removeClass("expanded"),$("#authorListToggleArrow").toggleClass("slOpen slClose")):(n.isAuthorListsLoaded||n.fetchAuthorListsService.call(n),$(this).addClass("expanded"),n.$authorModalEl.find(".head-sub").stop().slideDown(100),$("#authorListToggleArrow").toggleClass("slClose slOpen"))});u.click(function(){if($(this).attr("checked")!=="checked"&&$(this).attr("checked",!0),$(this).is("#create-new-list")&&($(".list-title").focus(),t.hasClass("open-list"))){r.stop(!0,!0).slideUp(100);t.removeClass("open-list");modalScrollHelper();return}});f.click(function(){var t=$(this).parents(".authors-detail-wrapper").find(".selected").attr("listid");$("#add-to-list").is(":checked")?n.addToListService(t):n.createNewListService()});e.click(function(){$(".add").hasClass("expanded")&&$(".add").removeClass("expanded");$("#authorListToggleArrow").toggleClass("slOpen slClose");n.$authorModalEl.find(".head-sub").stop().slideUp(100)});t.click(function(n){if(n.stopPropagation(),$(this).hasClass("open-list")){r.stop(!0,!0).slideUp(100);$(this).removeClass("open-list");modalScrollHelper();return}r.stop(!0,!0).slideDown(100);$(this).addClass("open-list");modalScrollHelper(!0)});i.click(function(n){n.stopPropagation();r.stop(!0,!0).slideUp(100);modalScrollHelper()})},fetchAuthorListsService:function(){progressIndicator.display(translate("fetchingAuthorLists"),!1,!1,!0);var n=new RequestContext("factiva.com.ui.services.AuthorsService",this,null,this.fetchAuthorListsSuccess,this.handleError);return n.Send(),!1},fetchAuthorListsSuccess:function(n){var f=parseJSON(n.Text),t,r,o;if(f==null)return!1;var s=f.savedAuthorListItemDTO,e=f.savedAuthorListViewDTO,u=e.personal,i=[];if(u)for(t=0;t<u.item.length;t++)i[i.length]='<li class="filter-list-item" listid="'+u.item[t].id+'" type="'+translate("listPersonalType")+'">'+u.item[t].name+"<\/li>";if(r=e.group,r)for(t=0;t<r.item.length;t++)i[i.length]='<li class="filter-list-item" listid="'+r.item[t].id+'" type="'+translate("listGroupType")+'">'+r.item[t].name+"<\/li>";$(".report-options-wrapper .filter-list").html(i.join(""));o=$(".filter-list-item");o.click(function(n){n.stopPropagation();var t=$(this).text(),i=$(this).attr("listid");$(this).addClass("active").siblings().removeClass("active");$(this).parents(".authors-detail-wrapper").find(".selected").removeClass("unselected").text(t).attr("title",t).attr("listid",i).parent().removeClass("open-list");$(".filter-wrapper").stop(!0,!0).slideUp(100);$("#add-to-list").val(t);modalScrollHelper()});progressIndicator.hide(500);n.ClientContext.isAuthorListsLoaded=!0},handleError:function(n){var t=n.Error.Description;progressIndicator.hide();alert(t)},createNewListService:function(){if(this.strListTitle=$("#create-new-list").parent().find(".list-title").val(),hasIllegalChar2(this.strListTitle))return alert(translate("illegalChar-1")+" (<, >, &, #, \\, %, +, |, ~) "+translate("illegalChar-2")),!1;if($.trim(this.strListTitle)=="")alert(translate("enterNewName"));else{var n=new RequestContext("factiva.com.ui.services.AuthorsService",this,null,this.createListSuccessAU,this.handleError);n.Add("rType","AddNewList");n.Add("listName",this.strListTitle);n.Add("accountItem",!1);n.Send()}},addToListService:function(n){if(n=="0")alert(translate("plsSelectList"));else{var t=new RequestContext("factiva.com.ui.services.AuthorsService",this,null,this.addToListSuccessAU,this.handleError);t.Add("rType","AddToList");t.Add("listid",n);t.Add("arraycodes",this.nnid+"_");t.Send()}},addToListSuccessAU:function(n){if(typeof tabs!="undefined"&&tabs)for(var t=0;t<tabs.length;t++)$(tabs[t]).text().trim()==translate("authorLabel")&&(tabs[t].className="pnlTabOpen",setPnlDsply(tabs[t].pnl,!1));n.ClientContext.$authorModalEl.find(".head-sub").stop().slideUp(100);n.ClientContext.$authorDeetsEl.removeClass("expanded");modalScrollHelper()},createListSuccessAU:function(n){var i=parseJSON(n.Text);n.ClientContext.addToListService(i.newItemId);n.ClientContext.fetchAuthorListsSuccess(n);$("#create-new-list").parent().find(".list-title").val("");$("#add-to-list").attr("checked",!0);$("#add-to-list").prop("checked",!0);$("#create-new-list").attr("checked",!1);$("#create-new-list").prop("checked",!1);var r=$(".filter-list-item"),t=n.ClientContext.strListTitle,u=i.newItemId;return r.addClass("active").siblings().removeClass("active"),r.parents(".authors-detail-wrapper").find(".selected").removeClass("unselected").text(t).attr("title",t).attr("listid",u).parent().removeClass("open-list"),$(".filter-wrapper").stop(!0,!0).slideUp(100),$("#add-to-list").val(t),modalScrollHelper(),progressIndicator.hide(500),n.ClientContext.$authorModalEl.find(".head-sub").stop().slideUp(100),n.ClientContext.$authorDeetsEl.removeClass("expanded"),!1}},executiveCache,tplExecutive;logInfoClickOmniture=function(n,t,i){var r=!1;if($(".dj_emg_autosuggest_results").each(function(){r||(r=$(this).css("display")=="none"?!1:!0)}),r)return DJOmniture.logAuthorInfo("SB_AuthorInfo","Fact_RT_AuthInfo_"+i+"_"+n),!1;DJOmniture.logAuthorInfo(t,"Fact_RT_AuthInfo_"+i+"_"+n)};executiveCache=[];tplExecutive=["<table border='0' class='infoTable'>","  <tbody>","   <%if (data.name) {%>","\t    <tr><td colspan='2' class='entityFont'><%= data.name.fullName %><\/td><\/tr>","   <%}%>","  <tr><td class='label'><%=tokens.code%><\/td><td><%=data.execCode%><\/td><\/tr>","  <%if (data.company) {%>","    <tr><td class='label'><%=tokens.company%><\/td><td><%=data.company.name%><\/td><\/tr>","  <%}%>","<\/tbody><\/table>"].join("\n");
