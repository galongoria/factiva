function viewNextSrc(n,t,i){var u=$(n).parent(),r=$(u).parent();r.html('<div class="mnuMsg">'+translate("runningQueryPhrase")+"...<\/div>");i=="ml"?doXmlHttpOverLay(t,r[0]):(t+=$("#lkTrTab")[0].attributes["class"].value=="pnlTrTabOpen"?"&excDiscSrcs="+($("#excDiscSrcslk").is(":checked")?"1":"0"):"&excDiscSrcs="+($("#excDiscSrcs").is(":checked")?"1":"0"),doXmlHttp(t,r[0]))}var RIND={};RIND.getModalPopupTitle=function(n){switch(n){case"co":case"ticker":return"companyInformation";case"re":return"regionInfo";case"ns":return"subjectInfo";case"in":return"industryInfo";case"sc":return"sourceInfo";case"fes":return"fesInfo"}};RIND.EntityLists={};RIND.getRelevantSourceList=function(n,t){var i=new RequestContext("factiva.com.ui.services.SourceListFilterService",null,null,function(i){var e=0,u=$("#relInfoPopupBalloon"),r,o,s,f;if(i.Text&&(r=$.parseJSON(i.Text)),RIND.EntityLists=r,r.PersonalSourceList&&r.PersonalSourceList.length>0||r.GroupSourceList&&r.GroupSourceList.length>0){if(u.find("#sourceListLink").show(),r.PersonalSourceList&&r.PersonalSourceList.length>0){for(e+=r.PersonalSourceList.length,o=[],f=0;f<r.PersonalSourceList.length;f++)o[f]='<div class="sourceListItem">'+r.PersonalSourceList[f].Name+"<\/div>";u.find(".personalSourceListContent").html("<div>"+o.join("")+"<\/div>");u.find(".personalSourceList").show()}if(r.GroupSourceList&&r.GroupSourceList.length>0){for(e+=r.GroupSourceList.length,s=[],f=0;f<r.GroupSourceList.length;f++)s[f]='<div class="sourceListItem">'+r.GroupSourceList[f].Name+"<\/div>";u.find(".groupSourceListContent").html("<div>"+s.join("")+"<\/div>");u.find(".groupSourceList").show()}u.find("#sourceListToggle").append(" ("+e+") |");u.find("#sourceListToggle")[0].title=u.find("#sourceListToggle")[0].title.replace("[]",e)}else u.find("#sourceListNotFoundLabel").append(" (0) |"),u.find("#sourceListNotFoundLabel")[0].title=u.find("#sourceListToggle")[0].title.replace("[]",0),u.find("#sourceListNotFoundLabel").show();u.find(".hr-divider").show();u.find(".sourceListDiv").before("<div class='sourceListLbl'>"+translate("srcInfoPopThisSourceAlso")+"<\/div>");RIND.showSourceListDropDown(n,r.IsAdminUser,t,!r.ShowAddToListOption,r.CanAddSourceLists)},function(n){var t=$("#relInfoPopupBalloon");t.find("#sourceListsPnl").show();n&&n.Error&&n.Error.Number&&n.Error.Description&&(t.find(".sourceListError").html("("+n.Error.Number+") "+n.Error.Description),t.find(".sourceListError").show())});i.Add("sourceCode",n);i.Send()};RIND.showSourceListDropDown=function(n,t,i,r,u){var f=$("#relInfoPopupBalloon"),a=$("#saveSourceListsPnl"),e=$("#ml_sc_createoverlay"),o=$("#ml_sc_editoverlay"),s=f.find("#sourceListNotFoundLabel"),h=e.length>0&&e.is(":visible")||o.length>0&&o.is(":visible")||!u?!0:!1,c=f.find("#sourceListNotFoundLabel").is(":visible"),v={addToList:translate("addToList"),chooseList:translate("chooseList"),createNewList:translate("createNewList"),save:translate("save"),cancel:translate("cancel"),addAsExclSourceInList:translate("addAsExclSourceInList"),groupItem:translate("groupItem")},l;if(h&&c){s.text(s.text().replace("|",""));return}typeof RIND.tpl=="string"&&(RIND.tpl=_.template(RIND.tpl));l=RIND.tpl({tokens:v,isAdminUser:t,hideCreateAddToList:h,hideAddToListDropDown:r,noSrcListsForSrc:c});a.html(l);f.find("#saveSourceListLink").show();RIND.sourceListDropDown.init(n,i)};RIND.tpl=["      <form action='' method='post' data-hidecreateaddtolist='<%=  hideCreateAddToList %>' data-srclstnotfound='<%=  noSrcListsForSrc %>'>","        <div class='or-not-wrapper'>","           <input id='excl-in-list' name='list-incl-excl' type='checkbox' value='not' />","           <label for='not'><%= tokens.addAsExclSourceInList %><\/label>","        <\/div>","\t  <%if (!hideAddToListDropDown) {%>","        <div class='add-wrapper'>","\t  <%} else { %>","        <div class='add-wrapper' style='display:none !important'>","\t  <%}%>","           <input checked='checked' id='add-to-list' name='list-select' type='radio' value='' />","           <label for='add-to-list'><%= tokens.addToList %><\/label>","           <div class='report-options-wrapper report-in-wrapper'>","               <span class='selected unselected ellipsis' title='default' listid='0'><%= tokens.chooseList %><\/span>","               <span class='fi-two fi_d-arrow-thick-drk-gray'><\/span>","               <div class='filter-wrapper'>","                   <ul class='filter-list'>","                   <\/ul>","               <\/div>","           <\/div>","        <\/div>","        <div class='create-wrapper'>","              <input id='create-new-list' name='list-select' type='radio' value='create' />","              <label for='create-new-list'><%= tokens.createNewList %><\/label>","              <input class='list-title' maxlength='30' name='list-title' type='text' value='' />","        <\/div>","\t  <%if (isAdminUser) {%>","        <div class='create-groupitem-wrapper'>","              <input id='chbx-create-groupitem' name='group-item-select' type='checkbox' />","              <label for='group-list-select'><%= tokens.groupItem %><\/label>","        <\/div>","     <%}%>","        <div class='submit-wrapper'>","              <div class='dj-list-item'>","                <a class='dj_btn dj_btn-blue' href='javascript:void(0);' id='save-new-author-list'><%= tokens.save %><\/a>","                <a class='dj_btn dj_btn-grey' href='javascript:void(0);' id='cancel-new-author-list'><%= tokens.cancel %><\/a>","              <\/div>","        <\/div>","    <\/form>","    <div class='clearfix'><\/div>",""].join("\n");RIND.sourceListDropDown={sourceCode:null,isSourceListsLoaded:!1,$sourceInfoModal:null,$saveListTgl:null,$saveListLnk:null,strListTitle:null,sourceName:null,isGroupItm:!1,hideCreateAddToList:!1,noSrcListsForSrc:!1,isAddToListForm:!1,listName:null,init:function(n,t){var i=this;i.isSourceListsLoaded=!1;i.sourceCode=n;i.$sourceInfoModal=$("#relInfoPopupBalloon");i.$saveListTgl=i.$sourceInfoModal.find("#saveSourceListToggle");i.$saveListLnk=i.$sourceInfoModal.find("#saveSourceListLink");i.hideCreateAddToList=i.$sourceInfoModal.find("form").data("hidecreateaddtolist");i.noSrcListsForSrc=i.$sourceInfoModal.find("form").data("srclstnotfound");i.sourceName=t;i.isAddToListForm=i.$sourceInfoModal.find("form").length>0;var r=i.$sourceInfoModal.find(".report-in-wrapper"),u=i.$sourceInfoModal.find(".open-list"),f=r.find(".filter-wrapper"),e=i.$sourceInfoModal.find("#save-new-author-list"),o=i.$sourceInfoModal.find("#cancel-new-author-list"),s=i.$sourceInfoModal.find(".add-wrapper,.create-wrapper").find("input:radio"),h=i.$sourceInfoModal.find(".list-title");i.resetGroupItemCheckbox(i,!1);i.setToggleLinkTitle(i);i.handleEvents(i,r,u,f,e,o,s,h)},handleEvents:function(n,t,i,r,u,f,e,o){n.$saveListLnk.click(function(t){t.stopPropagation();n.toggleListsDropDown(n);n.$saveListTgl.hasClass("slClose")||n.isSourceListsLoaded||n.hideCreateAddToList||!n.$sourceInfoModal.find(".add-wrapper").is(":visible")||n.fetchSourceListsService.call(n)});o.focus(function(t){t.stopPropagation();n.$sourceInfoModal.find(".add-wrapper input:radio").prop("checked",!1).attr("checked",!1);n.$sourceInfoModal.find(".create-wrapper input:radio").prop("checked",!0).attr("checked",!0)});e.click(function(){var i=$(this);if(i.attr("checked")!=="checked"&&i.attr("checked",!0),i.is("#create-new-list")){if(o.focus(),t.hasClass("open-list")){r.stop(!0,!0).slideUp(100);t.removeClass("open-list");modalScrollHelper();return}n.resetGroupItemCheckbox(n)}else if(i.is("#add-to-list")){n.resetGroupItemCheckbox(n,!1);return}});t.click(function(n){if(n.stopPropagation(),t.hasClass("open-list")){r.stop(!0,!0).slideUp(100);t.removeClass("open-list");modalScrollHelper();return}r.stop(!0,!0).slideDown(100);t.addClass("open-list");modalScrollHelper(!0)});i.click(function(n){n.stopPropagation();r.stop(!0,!0).slideUp(100);modalScrollHelper()});f.click(function(){n.toggleListsDropDown(n)});u.click(function(){var r=t.find(".selected").attr("listid"),u=n.$sourceInfoModal.find("#add-to-list"),i=t.find(".selected").text();i=i.substring(i.indexOf(":")+1).trim();u.is(":checked")?(n.isGroupItm=n.$sourceInfoModal.find(".filter-list-item").filter(function(){return $(this).attr("listid")==r}).data("is-grp")||!1,n.listName=i,n.addToListService(r)):(n.isGroupItm=n.$sourceInfoModal.find("#chbx-create-groupitem").is(":checked"),n.createNewListService())})},toggleListsDropDown:function(n){n.$saveListTgl.toggleClass("slClose slOpen").closest("td").find("#saveSourceListsPnl").toggle();n.$sourceInfoModal.find("#sourceListsPnl").toggle();n.$sourceInfoModal.find(".dt-divider").toggle();n.noSrcListsForSrc?n.$sourceInfoModal.find("#sourceListsPnl").css("display","none"):n.hideCreateAddToList&&n.$sourceInfoModal.find("form").css("display","none")},setToggleLinkTitle:function(n){var r=n.hideCreateAddToList,u=n.noSrcListsForSrc,t=translate("view"),i=translate("add"),f=n.$sourceInfoModal.find("#saveSourceListToggleTitle");t=t.charAt(0).toUpperCase()+t.slice(1);i=i.charAt(0).toUpperCase()+i.slice(1);n.isAddToListForm&&(!r||u)?!r&&u?f.text(i):r||u||f.text(translate("srcInfoPopViewAdd")):f.text(t)},fetchSourceListsService:function(){progressIndicator.hide();progressIndicator.display();var n=new RequestContext("factiva.com.ui.services.SourcesService",this,null,this.fetchSourceListsSuccess,this.handleError);return n.Send(),!1},fetchSourceListsSuccess:function(n){var e=parseJSON(n.Text),u,i,t,f,s;if(e==null)return!1;var o=e.listViewDTO,r=n.ClientContext.$sourceInfoModal,h=r.find(".filter-list");if($("#ml_main").length>0&&MLManager.processSuccessFetchList(e.listViewDTO,MLManager.getPageIdsAndSelectorForType("sc"),MLManager.editSourceListOverlay,MLManager.removeSourceList),u=o.personal,i=[],u)for(t=0;t<u.item.length;t++)i[i.length]='<li class="filter-list-item" listid="'+u.item[t].id+'" type="'+translate("listPersonalType")+'">'+u.item[t].name+"<\/li>";if(f=o.group,f)for(t=0;t<f.item.length;t++)i[i.length]='<li class="filter-list-item" data-is-grp="true" listid="'+f.item[t].id+'" type="'+translate("listGroupType")+'">'+translate("listGroupType")+": "+f.item[t].name+"<\/li>";h.html(i.join(""));s=r.find(".filter-list-item");s.click(function(t){t.stopPropagation();var i=$(this),u=i.text(),f=i.attr("listid");i.hasClass("entity-contained-in-list")||(i.addClass("active").siblings().removeClass("active"),r.find(".selected").removeClass("unselected").text(u).attr("title",u).attr("listid",f).parent().removeClass("open-list"),r.find(".filter-wrapper").stop(!0,!0).slideUp(100),r.find("#add-to-list").val(u),n.ClientContext.resetCreateAddRadioButtons(n.ClientContext),modalScrollHelper())});progressIndicator.hide(500);n.ClientContext.highlightEntityContainedLists(n.ClientContext);n.ClientContext.isSourceListsLoaded=!0},handleError:function(n){var t=n.Error.Description;progressIndicator.hide();notification.display(t,"error",n.ClientContext.$sourceInfoModal.find(".dt-divider"))},createNewListService:function(){var t=this.$sourceInfoModal.find(".list-title").val(),i=this.$sourceInfoModal.find("#chbx-create-groupitem").is(":checked"),u=typeof i=="undefined"?!1:i,r="",n;if(this.listName=t,hasIllegalChar2(t))return r=translate("illegalChar-1")+" (<, >, &, #, \\, %, +, |, ~) "+translate("illegalChar-2"),notification.display(r,"warning",this.$sourceInfoModal.find(".dt-divider")),!1;$.trim(t)==""?notification.display(translate("enterNewName"),"warning",this.$sourceInfoModal.find(".dt-divider")):(n=new RequestContext("factiva.com.ui.services.SourcesService",this,null,this.createListSuccessSC,this.handleError),n.Add("rType","AddNewList"),n.Add("listName",t),n.Add("accountItem",u),n.Send())},createListSuccessSC:function(n){var i=parseJSON(n.Text),t=n.ClientContext,r=i.newItemId;return t.addToListService(i.newItemId),t.fetchSourceListsSuccess(n),t.$sourceInfoModal.find(".list-title").val(""),t.resetOrNotCheckbox(n.ClientContext),t.resetCreateAddRadioButtons(n.ClientContext),t.resetGroupItemCheckbox(t),t.$sourceInfoModal.find(".add-wrapper").show(),!1},addToListService:function(n){var r=!this.$sourceInfoModal.find("#excl-in-list").is(":checked"),i='[{ 8: "'+this.sourceName+'", 11: "'+this.sourceCode+'", 14: 0, 0: 0, 12: 0, 7: 0, 4: 0, 5: 0, 6: 0, 10: 0 }]',t;return n=="0"?notification.display(translate("plsSelectList"),"warning",this.$sourceInfoModal.find(".dt-divider")):(t=new RequestContext("factiva.com.ui.services.SourcesService",this,null,this.addToListSuccessSC,this.handleError),t.Add("rType","AddToList"),t.Add("listid",n),r?t.Add("scs",i):t.Add("xsc",i),t.Add("retLists","true"),t.Send()),!1},addToListSuccessSC:function(n){var t=n.ClientContext,r,i;if(n.Text&&(r=$.parseJSON(n.Text)),typeof tabs!="undefined"&&tabs)for(i=0;i<tabs.length;i++)$(tabs[i]).text().trim()==translate("sourcesLabel")&&(tabs[i].className="pnlTabOpen",setPnlDsply(tabs[i].pnl,!1));t.resetOrNotCheckbox(n.ClientContext);t.updateSourceListsDropDown(t,r);RIND.EntityLists=r;t.highlightEntityContainedLists(t);t.$sourceInfoModal.find(".filter-list-item").removeClass("active");t.$sourceInfoModal.find(".selected").removeClass("unselected").text(translate("chooseList")).attr("title",translate("chooseList")).attr("listid","0").parent().removeClass("open-list");t.$sourceInfoModal.find(".filter-wrapper").stop(!0,!0).slideUp(100);t.$sourceInfoModal.find("#add-to-list").val("");notification.display(translate("sourceAddedToList"),"success",t.$sourceInfoModal.find(".dt-divider"))},updateSourceListsDropDown:function(n,t){var f=n.isGroupItm,i=n.$sourceInfoModal.find("#sourceListLink").parent(),u=f==!0?i.find(".groupSourceList"):i.find(".personalSourceList"),c=f==!0?u.find(".groupSourceListContent"):u.find(".personalSourceListContent"),l=i.find("#sourceListToggle"),s=u.find(".sourceListItem"),a=s.is(':contains("'+n.listName+'")'),e=s.parent(),v=n.$sourceInfoModal.find("#sourceListsPnl"),y=i.find(".groupSourceList").find(".sourceListItem").length,p=i.find(".personalSourceList").find(".sourceListItem").length,w=y+p+1,o=null,h=[],r;if(!a){for((t.PersonalSourceList&&t.PersonalSourceList.length>0||t.GroupSourceList&&t.GroupSourceList.length>0)&&(o=f==!0?t.GroupSourceList:t.PersonalSourceList),e.length==0&&(e=$("<div>").appendTo(c),n.$sourceInfoModal.find("#sourceListLink").css("display","block"),n.$sourceInfoModal.find("#sourceListNotFoundLabel").css("display","none"),v.show(),u.show()),r=0;r<o.length;r++)h[r]='<div class="sourceListItem">'+o[r].Name+"<\/div>";e.empty().html(h.join(""));l.text(translate("sourceLists")+" ("+w+") |");n.noSrcListsForSrc=!1;n.setToggleLinkTitle(n)}},highlightEntityContainedLists:function(n){var i=[],r={},u=RIND.EntityLists.PersonalSourceList===null?0:RIND.EntityLists.PersonalSourceList.length,f=RIND.EntityLists.GroupSourceList===null?0:RIND.EntityLists.GroupSourceList.length,t;for(n.$sourceInfoModal.find(".filter-list-item").removeClass("entity-contained-in-list"),t=0;t<u;t++)i.push(RIND.EntityLists.PersonalSourceList[t].Id.toString());for(t=0;t<f;t++)i.push(RIND.EntityLists.GroupSourceList[t].Id.toString());r=n.$sourceInfoModal.find(".filter-list-item").filter(function(){return i.contains($(this).attr("listid"))}).addClass("entity-contained-in-list")},resetOrNotCheckbox:function(n){n.$sourceInfoModal.find(".or-not-wrapper #excl-in-list").prop("checked",!1).attr("checked",!1)},resetCreateAddRadioButtons:function(n){n.$sourceInfoModal.find(".add-wrapper input:radio").prop("checked",!0).attr("checked",!0);n.$sourceInfoModal.find(".create-wrapper input:radio").prop("checked",!1).attr("checked",!1)},resetGroupItemCheckbox:function(n,t){t=typeof t=="undefined"?!0:t;n.$sourceInfoModal.find("#chbx-create-groupitem").prop("checked",!1).attr("checked",!1).prop("disabled",!t).attr("disabled",!t);n.$sourceInfoModal.find(".add-wrapper").is(":visible")||(n.$sourceInfoModal.find(".create-wrapper input:radio").prop("checked",!0).attr("checked",!0),n.$sourceInfoModal.find("#chbx-create-groupitem").prop("disabled",!1).attr("disabled",!1).prop("checked",!1).attr("checked",!1))}};RIND.getEntityDetails=function(n,t,i,r,u,f){var o=500,e;progressIndicator.display("");e=new RequestContext("factiva.com.ui.ri.relatedIndexingService",null,null,function(r){var u,e;progressIndicator.hide();RIND.showPopupBalloon(r.Text,translate(RIND.getModalPopupTitle(i)),o,"dj_popup-org",i,f);u=$("div.popup-balloon");i=="sc"&&u.find("#sourceListLink").length&&RIND.getRelevantSourceList(t,n);i==="fes"&&CopyPasteTracker&&(e="FES_RT_"+n.replace(/ /g,"_")+"_"+t+"_Copy",CopyPasteTracker.bindCopyEvent($(u.find(".value")[1]),e));u.parent().css("z-index","200000")},function(n){progressIndicator.hide();RIND.showPopupBalloon("("+n.Error.Number+") "+n.Error.Description,"",o);$("div.popup-balloon").parent().css("z-index","200000")});e.Add("code",t);e.Add("displayName",n);e.Add("categoryType",i);e.Add("hideListEditor",$("#ml_"+i+"_createoverlay:visible,#ml_"+i+"_editoverlay:visible, #ml_"+i+"_overlay:visible").length>0);typeof u=="string"&&u.length>0&&e.Add("codingScheme",u);i=="sc"&&e.Add("isGrpSrc",r);e.Send();i!="sc"&&DJOmniture.logRelatedInfo(i);i=="fes"?DJOmniture.logFesInfoIcon("Fact_RT_FES_"+n.replace(/ /g,"_")+"_"+t):DJOmniture.logSourceInformationModalClick(t,n,i);DJMetrics.captureViewDetailsClick(i,t,n)};RIND.showPopupBalloon=function(n,t,i,r,u,f){var e,o;u=u||"";e=getPopupBalloonTemplate("relInfoPopupBalloon",t,i,"auto");e.removeClass().addClass("popup-balloon with-title").addClass(r).find(".content").html(n);e.find(".content").css("height",u=="fes"?250:"auto");e.parent().show();e.outerHeight(!0)>$(window).height()&&e.find(".content").css("overflow","auto").height($(window).height()-e.find(".header").outerHeight(!0)-20);e.parent().is("body")||e.parent().hide();e.overlay({bgcolor:"#555",closeOnEsc:!0,background:!0,onHide:function(){f&&typeof f=="function"&&f(u,RIND.shouldRefreshLists)}});(u==="co"||u==="in"||u==="re"||u==="ns")&&this.wireUpFactivaListBuilder();$.browser.mozilla&&(o=parseFloat($.browser.version),o>=2&&o<7&&e.find(".ellipsis").ellipsis({intervalDelay:0}))};RIND.wireUpFactivaListBuilder=function(){function n(){$(".factiva-list-builder .toggle.icon").toggleClass("open")}function t(n){function i(n,t){return n.replace(/\(\d+\)/,"("+t+")")}var t=$(".factiva-list-builder .company-lists-count-label"),r=t.attr("title"),u=t.text();t.attr("title",i(r,n)).text(i(u,n));RIND.shouldRefreshLists=!0}window.FLB&&window.FLB.company.init({onSaveSuccess:t,onCancel:n});$(".factiva-list-builder .toggle").click(function(){$(this).closest(".factiva-list-builder").find(".toggle.icon").toggleClass("open");window.FLB.company.toggleContainer()})};
